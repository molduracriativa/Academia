<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>CÃ¢mera com Quadrado Liga/Desliga</title>

<style>
    body {
        margin: 0;
        overflow: hidden;
        background: #000;
    }

    #container {
        position: relative;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
    }

    video, canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Moldura */
    #frame {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }

    /* Quadrado liga/desliga */
    #toggleSquare {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
        border: 3px solid #fff;
        border-radius: 4px;
        background: transparent;
        cursor: pointer;
        z-index: 9999;
    }

    /* Quando ligado (preenchido) */
    .active {
        background: #fff !important;
    }

    button {
        position: absolute;
        bottom: 25px;
        left: 50%;
        transform: translateX(-50%);
        padding: 12px 20px;
        border: none;
        border-radius: 10px;
        background: #25d366;
        color: #fff;
        font-size: 17px;
        cursor: pointer;
        z-index: 999;
    }

</style>
</head>
<body>

<div id="container">
    <video id="video" autoplay muted playsinline></video>
    <img id="frame" src="moldura1.png">

    <!-- Quadrado ON/OFF -->
    <div id="toggleSquare"></div>

    <button id="capturePhoto">ðŸ“¸ Foto</button>
    <button id="recordVideo" style="left: auto; right: 20px;">ðŸŽ¥ VÃ­deo</button>
</div>

<canvas id="canvas" style="display:none;"></canvas>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const square = document.getElementById("toggleSquare");
let squareActive = false;

// Liga / desliga quadrado
square.addEventListener("click", () => {
    squareActive = !squareActive;

    if (squareActive) square.classList.add("active");
    else square.classList.remove("active");
});

// Iniciar cÃ¢mera
navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" }, audio: true })
.then(stream => {
    video.srcObject = stream;
})
.catch(err => alert("Erro na cÃ¢mera: " + err));

// FunÃ§Ã£o para desenhar no canvas (foto e vÃ­deo usam isso)
function drawToCanvas() {
    const ctx = canvas.getContext("2d");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    // Desenhar moldura
    const frame = document.getElementById("frame");
    ctx.drawImage(frame, 0, 0, canvas.width, canvas.height);

    // Desenhar quadrado se estiver ligado
    if (squareActive) {
        const size = 40 * (canvas.width / window.innerWidth);
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(canvas.width - size - 40, 40, size, size);
    }
}

// FOTO
document.getElementById("capturePhoto").onclick = () => {
    drawToCanvas();
    const link = document.createElement("a");
    link.download = "foto.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
};

// VÃDEO
let mediaRecorder;
let chunks = [];
let recording = false;

document.getElementById("recordVideo").onclick = () => {
    if (!recording) {
        startRecording();
    } else {
        stopRecording();
    }
};

function startRecording() {
    recording = true;
    document.getElementById("recordVideo").innerText = "â¹ Parar";

    // Canvas stream com 30 fps
    const stream = canvas.captureStream(30);
    mediaRecorder = new MediaRecorder(stream, {
        mimeType: "video/webm;codecs=vp9"
    });

    mediaRecorder.ondataavailable = e => chunks.push(e.data);

    mediaRecorder.onstop = () => {
        const blob = new Blob(chunks, { type: "video/webm" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "video.webm";
        a.click();
        chunks = [];
    };

    mediaRecorder.start();

    renderLoop();
}

function stopRecording() {
    recording = false;
    document.getElementById("recordVideo").innerText = "ðŸŽ¥ VÃ­deo";

    mediaRecorder.stop();
}

// RenderizaÃ§Ã£o contÃ­nua para o vÃ­deo
function renderLoop() {
    if (!recording) return;
    drawToCanvas();
    requestAnimationFrame(renderLoop);
}
</script>

</body>
</html>
