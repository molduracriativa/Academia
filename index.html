<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>Camera Customizada</title>

<style>
    :root {
        --accent: #25D366;
        --record: #ff4444;
    }

    body, html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: #000;
        overflow: hidden;
        font-family: Arial, sans-serif;
    }

    /* ---------------------- TELA COM A CAPA ---------------------- */
    #startScreen {
        position: fixed;
        inset: 0;
        background-image: url("capa.jpg");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;

        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    #startScreen h1 {
        color: #fff;
        font-size: 26px;
        text-shadow: 0 0 8px #000;
        margin-bottom: 10px;
    }

    #startScreen p {
        color: #fff;
        text-shadow: 0 0 8px #000;
        margin-bottom: 25px;
    }

    #startButton {
        background: #ff5a1f;
        color: #fff;
        padding: 15px 35px;
        border-radius: 40px;
        border: none;
        font-size: 17px;
        font-weight: bold;
        cursor: pointer;
    }

    /* ---------------------- CAMADAS DA C츽MERA ---------------------- */
    #camera {
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
    }

    #canvasPreview,
    #canvasFinal {
        display: none;
    }

    #molduraImagePreview {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: contain;
        pointer-events: none;
        z-index: 5;
    }

    /* ---------------------- UI ---------------------- */
    .ui-layer {
        position: absolute;
        inset: 0;
        z-index: 10;
        pointer-events: none;
    }

    .ui-layer button {
        pointer-events: all;
    }

    .top-bar {
        width: 100%;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        box-sizing: border-box;
    }

    .controls-bottom {
        position: absolute;
        bottom: 25px;
        width: 100%;
        display: flex;
        justify-content: center;
        gap: 30px;
    }

    /* ---------------------- C칈RCULOS DA MOLDURA1 ---------------------- */
    #circlesPanel {
        position: absolute;
        top: 50%;
        right: 1.2cm;   /* AJUSTE EXATO PEDIDO */
        transform: translateY(-50%);
        display: none; /* s칩 aparece quando moldura1 ativa */
        flex-direction: column;
        gap: 15px;
        z-index: 12;
    }

    .circle {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 3px solid white;
        background: transparent;
        cursor: pointer;
    }

    .circle.on {
        background: white;
    }

</style>
</head>

<body>

<!-- ---------------------- TELA INICIAL COM CAPA ---------------------- -->
<div id="startScreen">
    <h1>Configura칞칚o de C칙mera</h1>
    <p>Permita acesso para iniciar.</p>
    <button id="startButton">INICIAR C츽MERA</button>
</div>

<!-- ---------------------- C츽MERA ---------------------- -->
<video id="camera" autoplay playsinline muted></video>
<canvas id="canvasPreview"></canvas>
<canvas id="canvasFinal"></canvas>
<video id="videoPreview" playsinline controls></video>

<img id="molduraImagePreview" src="" />

<div class="flash" id="flash"></div>

<div class="ui-layer" id="cameraUI" style="display:none;">
    <div class="top-bar">
        <button class="btn" id="switchBtn">游댃 Trocar C칙mera</button>
        <div id="recordingTimer" class="timer-badge">00:00</div>
    </div>

    <div class="controls-bottom">
        <button id="btnFoto">游닞</button>
        <button id="btnVideo">游꿘</button>
    </div>
</div>

<!-- ---------------------- C칈RCULOS LIGA/DESLIGA ---------------------- -->
<div id="circlesPanel">
    <div class="circle" data-id="1"></div>
    <div class="circle" data-id="2"></div>
    <div class="circle" data-id="3"></div>
    <div class="circle" data-id="4"></div>
    <div class="circle" data-id="5"></div>
    <div class="circle" data-id="6"></div>
    <div class="circle" data-id="7"></div>
</div>

<script>
/* ========================== TELA INICIAL ========================== */
const startScreen = document.getElementById("startScreen");
const startButton = document.getElementById("startButton");

startButton.addEventListener("click", () => {
    startScreen.style.display = "none";
    initCamera(); // SUA FUN칂츾O NORMAL DE ABRIR CAMERA
});

/* ========================== INICIALIZA칂츾O DA C츽MERA ========================== */
/* Use exatamente sua fun칞칚o j치 existente */
async function initCamera() {
    const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "user" }, audio: true
    });

    camera.srcObject = stream;
    document.getElementById("cameraUI").style.display = "block";
}

/* ========================== C칈RCULOS LIGA/DESLIGA ========================== */
const circlesPanel = document.getElementById("circlesPanel");
const circles = document.querySelectorAll(".circle");

circles.forEach(circle => {
    circle.addEventListener("click", () => {
        circle.classList.toggle("on");
    });
});

/* ========================== EXIBIR C칈RCULOS SOMENTE NA MOLDURA1 ========================== */
function ativarMoldura1() {
    molduraImagePreview.src = "moldura1.png";
    circlesPanel.style.display = "flex";
}

function desativarMolduras() {
    molduraImagePreview.src = "";
    circlesPanel.style.display = "none";
}

/* ========================== FOTO FINAL COM MOLDURA + C칈RCULOS ========================== */

function salvarFotoFinal() {
    const canvas = document.getElementById("canvasFinal");
    const ctx = canvas.getContext("2d");

    canvas.width = camera.videoWidth;
    canvas.height = camera.videoHeight;

    ctx.drawImage(camera, 0, 0, canvas.width, canvas.height);

    if (molduraImagePreview.src) {
        ctx.drawImage(molduraImagePreview, 0, 0, canvas.width, canvas.height);
    }

    circles.forEach(circle => {
        if (circle.classList.contains("on")) {
            ctx.fillStyle = "white";
        } else {
            ctx.lineWidth = 4;
            ctx.strokeStyle = "white";
        }
    });

    const link = document.createElement("a");
    link.download = "foto.png";
    link.href = canvas.toDataURL();
    link.click();
}

</script>

</body>
</html>
