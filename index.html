<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
<title>C√¢mera Customizada</title>

<style>
    :root {
        --accent: #25D366;
        --record: #ff3b30;
    }

    body, html {
        margin: 0;
        padding: 0;
        background: #000;
        overflow: hidden;
        font-family: Arial, sans-serif;
    }

    /* ‚≠ê TELA INICIAL COM CAPA (AJUSTADO) */
    #startScreen {
        position: absolute;
        inset: 0;
        background-image: url('capa.jpg'); /* CORRE√á√ÉO AQUI */
        background-size: cover;
        background-position: center;
        display: flex;
        flex-direction: column;
        align-items:center;
        justify-content:center;
        gap: 20px;
        text-align:center;
        z-index: 50;
    }

    #startBtn {
        padding: 15px 35px;
        font-size: 22px;
        border-radius: 15px;
        border: none;
        background: var(--accent);
        color: #fff;
        cursor: pointer;
    }

    video#camera {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: none;
        z-index: 1;
    }

    #canvasPreview,
    #canvasFinal {
        display: none;
    }

    #molduraImagePreview {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: contain;
        pointer-events: none;
        z-index: 10;
        display: none;
    }

    #videoPreview {
        display: none;
    }

    .flash {
        position: absolute;
        inset: 0;
        background: white;
        opacity: 0;
        pointer-events: none;
        z-index: 20;
        transition: opacity 0.15s ease-out;
    }

    /* ‚≠ê BARRA SUPERIOR */
    .ui-layer {
        position: absolute;
        inset: 0;
        display: none;
        z-index: 30;
    }

    .top-bar {
        position: absolute;
        top: 10px;
        width: 100%;
        display: flex;
        justify-content: space-between;
        padding: 0 15px;
        pointer-events: auto;
    }

    .timer-badge {
        background: rgba(0,0,0,0.6);
        padding: 6px 12px;
        border-radius: 10px;
        color: #fff;
        font-size: 16px;
    }

    .btn {
        padding: 10px 20px;
        border-radius: 12px;
        border: none;
        font-size: 16px;
        cursor: pointer;
        background: rgba(0,0,0,0.65);
        color:white;
    }

    /* ‚≠ê CONTROLES INFERIORES */
    .controls-bottom {
        position: absolute;
        bottom: 18px;
        width: 100%;
        display: flex;
        justify-content: center;
        gap: 20px;
        pointer-events: auto;
    }

    /* ‚≠ê BOT√ÉO TIRAR FOTO / V√çDEO */
    #captureBtn, #recordBtn {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 5px solid white;
        background: rgba(255,255,255,0.2);
        cursor: pointer;
    }

    #recordBtn.recording {
        background: var(--record);
        border-color: var(--record);
    }

    /* ‚≠ê C√çRCULOS ON/OFF */
    .circles-container {
        position: absolute;
        right: 1.2cm;         /* AJUSTE QUE VOC√ä PEDIU */
        top: 28%;
        display: flex;
        flex-direction: column;
        gap: 14px;
        z-index: 40;
        pointer-events: auto;
    }

    .circle {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 3px solid white;
        cursor: pointer;
    }

    .circle.on {
        background: white;
    }
</style>
</head>

<body>

<!-- ‚≠ê TELA INICIAL COM CAPA.JPG -->
<div id="startScreen">
    <button id="startBtn">INICIAR C√ÇMERA</button>
</div>

<video id="camera" autoplay playsinline muted></video>

<canvas id="canvasPreview"></canvas>
<canvas id="canvasFinal"></canvas>
<video id="videoPreview" playsinline controls></video>

<img id="molduraImagePreview" src="moldura1.png" />

<div class="flash" id="flash"></div>

<!-- ‚≠ê INTERFACE DE GRAVA√á√ÉO -->
<div class="ui-layer" id="cameraUI">
    <div class="top-bar">
        <button class="btn" id="switchBtn">üîÑ Trocar C√¢mera</button>
        <div id="recordingTimer" class="timer-badge">00:00</div>
    </div>

    <div class="controls-bottom">
        <button id="captureBtn"></button>
        <button id="recordBtn"></button>
    </div>

    <!-- ‚≠ê OS 7 C√çRCULOS -->
    <div class="circles-container" id="circlesContainer"></div>
</div>

<script>
/* -------------------------------------------------------------------
   ‚≠ê INICIAR C√ÇMERA
------------------------------------------------------------------- */
let currentStream = null;
let usingFront = false;
let mediaRecorder = null;
let chunks = [];

const startBtn = document.getElementById("startBtn");
const startScreen = document.getElementById("startScreen");
const camera = document.getElementById("camera");
const cameraUI = document.getElementById("cameraUI");
const moldura = document.getElementById("molduraImagePreview");
const flash = document.getElementById("flash");

/* -------------------------------------------------------------------
   ‚≠ê INICIAR FLUXO DE C√ÇMERA
------------------------------------------------------------------- */
async function initCamera() {
    if (currentStream) {
        currentStream.getTracks().forEach(t => t.stop());
    }

    currentStream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: usingFront ? "user" : "environment" },
        audio: true
    });

    camera.srcObject = currentStream;
}

/* BOT√ÉO INICIAR */
startBtn.onclick = async () => {
    startScreen.style.display = "none";
    camera.style.display = "block";
    moldura.style.display = "block";
    cameraUI.style.display = "block";

    await initCamera();
};

/* TROCAR C√ÇMERA */
document.getElementById("switchBtn").onclick = async () => {
    usingFront = !usingFront;
    await initCamera();
};

/* -------------------------------------------------------------------
   ‚≠ê C√çRCULOS ON/OFF
------------------------------------------------------------------- */
const circlesContainer = document.getElementById("circlesContainer");
let circleStates = [false, false, false, false, false, false, false];

for (let i = 0; i < 7; i++) {
    const c = document.createElement("div");
    c.className = "circle";
    c.dataset.index = i;

    c.onclick = () => {
        circleStates[i] = !circleStates[i];
        c.classList.toggle("on", circleStates[i]);
    };

    circlesContainer.appendChild(c);
}

/* -------------------------------------------------------------------
   ‚≠ê CAPTURAR FOTO COM MOLDURA
------------------------------------------------------------------- */
document.getElementById("captureBtn").onclick = () => {
    flash.style.opacity = 1;
    setTimeout(() => flash.style.opacity = 0, 120);

    const canvas = document.getElementById("canvasPreview");
    const ctx = canvas.getContext("2d");

    canvas.width = camera.videoWidth;
    canvas.height = camera.videoHeight;

    ctx.drawImage(camera, 0, 0, canvas.width, canvas.height);
    ctx.drawImage(moldura, 0, 0, canvas.width, canvas.height);

    const link = document.createElement("a");
    link.download = "foto_moldura.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
};

/* -------------------------------------------------------------------
   ‚≠ê GRAVAR V√çDEO COM MOLDURA
------------------------------------------------------------------- */
const recordBtn = document.getElementById("recordBtn");
const timer = document.getElementById("recordingTimer");

let recInterval;

recordBtn.onclick = () => {
    if (!mediaRecorder || mediaRecorder.state === "inactive") {
        startRecording();
    } else {
        stopRecording();
    }
};

function startRecording() {
    chunks = [];
    recordBtn.classList.add("recording");

    mediaRecorder = new MediaRecorder(currentStream);
    mediaRecorder.ondataavailable = e => chunks.push(e.data);

    mediaRecorder.onstop = async () => {
        const blob = new Blob(chunks, { type: "video/mp4" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "video_moldura.mp4";
        a.click();
    };

    mediaRecorder.start();

    let s = 0;
    timer.textContent = "00:00";

    recInterval = setInterval(() => {
        s++;
        timer.textContent = 
            String(Math.floor(s/60)).padStart(2,"0") + ":" +
            String(s%60).padStart(2,"0");
    }, 1000);
}

function stopRecording() {
    clearInterval(recInterval);
    recordBtn.classList.remove("recording");
    mediaRecorder.stop();
}

</script>
</body>
</html>
